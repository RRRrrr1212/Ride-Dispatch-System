# 系統演示流程 (Ride Dispatch System Demo)

本文件說明如何啟動並演示 Ride Dispatch System 的各項功能。

## ⚠️ 前置準備 (Prerequisites)

在開始之前，請確保已安裝所有依賴並建置專案，特別是共享模組。

```bash
# 在專案根目錄下
cd clients
mvn clean install -DskipTests
cd ..
```

## 🚀 完整叫車流程 (Standard Flow)

### 1. 啟動後端
```bash
cd server
mvn spring-boot:run
```

### 2. 開啟管理後台 (觀察狀態)
可以在此觀察訂單與司機的即時狀態變化。
```bash
# 開啟新終端機
cd clients/web-client
npm run dev
```

### 3. 在瀏覽器開啟各端頁面
請開啟瀏覽器 (建議使用 Chrome) 並訪問以下網址：

- **管理後台**: `http://localhost:5173/login` (選擇 "管理員" 登入)
- **司機端**: `http://localhost:5173/login` (選擇 "司機" 登入)
  - 登入後，點擊右上角 **"上線"** 開關，確保狀態變為 **上線中**。
- **乘客端**: `http://localhost:5173/login` (選擇 "乘客" 登入)
  - 登入後即可看到地圖並開始叫車。

### 5. 司機接單與行程流程
1. **接單**: 司機列表出現新訂單，點擊 **"接單"**。
2. **開始行程**: 乘客上車後，點擊 **"開始行程"**。
3. **完成行程**: 到達目的地，點擊 **"完成行程"**。
   - 系統將顯示最終車資。
   - 司機狀態自動回到 **IDLE**，可繼續接單。

### 6. 觀察管理後台
- **訂單管理**: 訂單狀態依序變化 (CREATED -> MATCHED -> IN_PROGRESS -> COMPLETED)。
- **審計日誌**: 系統記錄每一步操作 (建立訂單、接單、更新狀態、計算車資)。

---

## 🔥 搶單演示 (Concurrency Demo)

此流程用於驗證系統的 **H2 併發控制** 能力，確保同一張訂單不會被多位司機同時接取。

1. **準備環境**: 
   - 開啟 **1 個** 乘客端視窗。
   - 開啟 **2 個以上** 的司機端視窗 (使用不同 Driver ID)。
2. **司機上線**: 
   - 讓所有司機都進入 **IDLE** 狀態。
3. **建立訂單**: 
   - 乘客端發出叫車請求。
4. **同時接單**: 
   - 兩個司機端都會看到該訂單。
   - 嘗試在兩邊 **同時點擊 "接單"** 按鈕。
5. **結果驗證**:
   - 只有 **1 位** 司機成功接單並進入 PICKING_UP 畫面。
   - 其他司機應收到錯誤訊息：**「此訂單已被其他司機接受 (Order already accepted)」**或**「搶單失敗」**。
   - 訂單列表自動刷新，該訂單消失。
